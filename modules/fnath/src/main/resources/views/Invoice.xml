<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">
    
    <!-- VUE GENERALE -->
    
    <grid name="invoice-grid" id="fnath-invoioce-grid" title="Invoices" model="com.axelor.apps.account.db.Invoice" orderBy="-invoiceDate">
    	<toolbar>
			<button name="printInvoices" title="Print invoices" icon="fa-print" onClick="action-invoice-method-show-invoice"/>
			<button name="massInvoiceValidation" title="Validate selected invoices" prompt="Are you sure you want to validate all selected invoices ?" onClick="action-invoice-method-mass-validation"/>
			<button name="massInvoiceVentilation" title="Ventilate selected invoices" prompt="Are you sure you want to ventilate all selected invoices ?" onClick="action-invoice-method-mass-ventilation"/>
    		<button name="mergeCustInvoices" title="Merge Cust. Invoices" onClick="action-invoice-mergecustinvoices" />
    	</toolbar>   
    	<hilite color="info" if="statusSelect == 1"/>
	    <hilite color="danger" if="statusSelect == 3 &amp;&amp; amountRemaining &gt; 0 &amp;&amp; $moment(dueDate).diff(todayDate,'days') &lt; 0"/>
	    <hilite color="warning" if="statusSelect == 3 &amp;&amp; amountRemaining &gt; 0 &amp;&amp; $moment(dueDate).diff(todayDate,'days') &lt;= 5"/>
	    <hilite color="success" if="statusSelect == 3 &amp;&amp; amountRemaining == 0"/>
        <field name="invoiceId"/>
        <field name="operationTypeSelect" />
        <field name="partner" form-view="partner-form" grid-view="partner-grid"/>
        <field name="paymentMode" grid-view="payment-mode-grid" form-view="payment-mode-form"/>
        <field name="invoiceDate"/>
        <field name="dueDate"/>
        <field name="exTaxTotal" aggregate="sum"/>
        <field name="inTaxTotal" aggregate="sum"/>
        <field name="amountRemaining" aggregate="sum"/>
        <field name="currency"/>
        <field name="statusSelect"/>
        <button name="showInvoice" title="Print" icon="fa-print" onClick="action-invoice-method-show-invoice"/>
        <button name="sendByEmail" title="Send email" icon="fa-envelope" onClick="action-send-by-email-with-template"/>
    </grid>
    
    <grid name="invoice-light-grid" title="Invoices" model="com.axelor.apps.account.db.Invoice" orderBy="-invoiceDate">
    	<toolbar>
			<button name="printInvoices" title="Print invoices" icon="fa-print" onClick="action-invoice-method-show-invoice"/>
			<button name="massInvoiceValidation" title="Validate selected invoices" prompt="Are you sure you want to validate all selected invoices ?" onClick="action-invoice-method-mass-validation"/>
			<button name="massInvoiceVentilation" title="Ventilate selected invoices" prompt="Are you sure you want to ventilate all selected invoices ?" onClick="action-invoice-method-mass-ventilation"/>
    	</toolbar>   
    	<hilite color="info" if="statusSelect == 1"/>
	    <hilite color="danger" if="statusSelect == 3 &amp;&amp; amountRemaining &gt; 0 &amp;&amp; $moment(dueDate).diff(todayDate,'days') &lt; 0"/>
	    <hilite color="warning" if="statusSelect == 3 &amp;&amp; amountRemaining &gt; 0 &amp;&amp; $moment(dueDate).diff(todayDate,'days') &lt;= 5"/>
	    <hilite color="success" if="statusSelect == 3 &amp;&amp; amountRemaining == 0"/>
        <field name="invoiceId"/>
        <field name="operationTypeSelect" />
        <field name="invoiceDate"/>
        <field name="exTaxTotal" aggregate="sum"/>
        <field name="amountRemaining" aggregate="sum"/>
        <field name="currency"/>
        <field name="statusSelect"/>
        <button name="showInvoice" title="Print" icon="fa-print" onClick="action-invoice-method-show-invoice"/>
        <button name="sendByEmail" title="Send email" icon="fa-envelope" onClick="action-send-by-email-with-template"/>
    </grid>
    
    <grid name="invoice-refund-grid" title="Invoices" model="com.axelor.apps.account.db.Invoice" orderBy="-invoiceDate">
    	<hilite color="info" if="statusSelect == 1"/>
	    <hilite color="danger" if="statusSelect == 3 &amp;&amp; amountRemaining &gt; 0 &amp;&amp; $moment(dueDate).diff(todayDate,'days') &lt; 0"/>
	    <hilite color="warning" if="statusSelect == 3 &amp;&amp; amountRemaining &gt; 0 &amp;&amp; $moment(dueDate).diff(todayDate,'days') &lt;= 5"/>
	    <hilite color="success" if="statusSelect == 3 &amp;&amp; amountRemaining == 0"/>
        <field name="invoiceId"/>
        <field name="operationTypeSelect" />
        <field name="invoiceDate"/>
        <field name="exTaxTotal" aggregate="sum"/>
        <field name="amountRemaining" aggregate="sum"/>
        <field name="statusSelect"/>
        <button name="showInvoice" title="Print" icon="fa-print" onClick="action-invoice-method-show-invoice"/>
    </grid>
    
	<form name="invoice-form" title="Invoice" model="com.axelor.apps.account.db.Invoice"  
	onNew="action-account-invoice-onnew-group" onLoad="action-account-invoice-onload-group">
	
		<toolbar>
		  <button name="showInvoice" title="Print" icon="fa-print" onClick="save,action-invoice-method-show-invoice"/>
		  <button name="showAnnex" title="Print annex" icon="fa-print" onClick="action-invoice-business-project-method-print-annex" if-module="axelor-business-project"/>
		  <button name="sendByEmail" title="Send email" icon="fa-envelope" onClick="save,action-send-by-email-with-template"/>
		</toolbar>
	  
		<panel name="main" >
			<field name="invoiceId"/>
			
	    	<field name="statusSelect" widget="NavSelect"/>
			<panel itemSpan="12" colSpan="6">
				<field name="operationTypeSelect" selection="iinvoice.operation.type.select" readonlyIf="statusSelect &gt; 1" showTitle="false" onChange="action-group-account-invoice-operationtype-onchange">
			        <viewer>
			        <![CDATA[
			
			 			<h3>
			             <span class="label label-important" ng-if="operationTypeSelect = 1" x-translate ng-show="record.operationTypeSelect == 1">Supplier purchase</span>
			             <span class="label label-important" ng-if="operationTypeSelect = 2" x-translate ng-show="record.operationTypeSelect == 2">Supplier refund</span>
			             <span class="label label-important" ng-if="operationTypeSelect = 3" x-translate ng-show="record.operationTypeSelect == 3">Customer sale</span>
			             <span class="label label-important" ng-if="operationTypeSelect = 4" x-translate ng-show="record.operationTypeSelect == 4">Customer refund</span>
			           </h3>
			
					]]>
					</viewer>
			     </field>
			
	    	</panel>
			<field name="company" widget="SuggestBox" onChange="action-group-account-invoice-company-onchange, action-invoice-attrs-hide-totals-company-currency" form-view="company-form" grid-view="company-grid" readonlyIf="statusSelect != 1"/>
			<field name="companyBankDetails" widget="SuggestBox" onSelect="action-invoice-attrs-domain-company-bank-details" form-view="bank-details-form" grid-view="bank-details-grid"/>
			<field name="currency" canEdit="false" onChange="action-invoice-attrs-change-total-title, action-invoice-attrs-hide-totals-company-currency" readonlyIf="statusSelect != 1" form-view="currency-form" grid-view="currency-grid"/>
			<field name="project" if-module="axelor-business-project" onSelect="action-invoice-attrs-domain-project" form-view="project-form" grid-view="project-grid" if="__config__.app.isApp('project')"/>
			<field name="inAti" onChange="action-invoice-attrs-in-ati"/>
			<field name="isSubscription" hidden="true"/>
		</panel>
	  
		<panel name="invoicingInformations" title="Invoicing informations">
			<field name="partner" form-view="partner-form" grid-view="partner-grid" readonlyIf="statusSelect != 1 || invoiceLineList.length > 0" onChange="action-group-account-invoice-partner-onchange,action-invoice-attrs-hide-totals-company-currency,action-method-invoice-address-str" onSelect="action-set-partner-domain"/>
			<field name="contactPartner"  onSelect="action-set-partner-domain" domain="self.isContact = true" form-view="partner-contact-form" grid-view="partner-contact-grid"
					readonlyIf="partner != null &amp;&amp; partner.partnerTypeSelect == 2"/>
			<panel stacked="true">
				<field name="address" hideIf="$readonly() ||Â statusSelect &gt; 1" onSelect="action-invoice-attrs-domain-address" onChange="action-method-invoice-address-str" form-view="address-partner-address-form" canEdit="false" canNew="true"/>
				<field name="addressStr" readonlyIf="statusSelect &gt; 1" height="5">
					<viewer>{{record.addressStr}}</viewer>
				</field>
			</panel>
			<field name="paymentMode" grid-view="payment-mode-grid" form-view="payment-mode-form" widget="SuggestBox" onSelect="action-set-payment-mode-domain" onChange="action-invoice-method-fill-company-bank-details"/>
			<field name="paymentCondition" readonlyIf="statusSelect == 3" widget="SuggestBox" onChange="action-invoice-record-due-date" form-view="payment-condition-form" grid-view="payment-condition-grid"/>
			<field name="bankDetails" widget="SuggestBox" onSelect="action-invoice-attrs-bank-details-from-partner-domain" form-view="bank-details-form" grid-view="bank-details-grid"/>
			<field name="priceList" onChange="action-invoice-record-hide-discount" readonlyIf="statusSelect != 1" onSelect="action-invoice-attrs-domain-priceList" form-view="price-list-form" grid-view="price-list-grid"/>
			<field name="saleOrder" if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('supplychain').getManageInvoicedAmountByLine()" if-module="axelor-supplychain" onChange="action-invoice-method-fill-in-lines" form-view="sale-order-form" grid-view="sale-order-grid"/>
			<field name="message" />
			<field name="supplierInvoiceNb" showIf="operationTypeSelect == 1 || operationTypeSelect == 2"/>
		</panel>
	  
		<panel-tabs>
			<panel name="invoiceContent" title="Invoice content" showTitle="false">
				<panel-related field="invoiceLineList" readonlyIf="statusSelect == 2 || statusSelect == 3 || partner == null" colSpan="12" form-view="invoice-line-form" grid-view="invoice-line-grid" onChange="action-invoice-method-compute" canMove="true" orderBy="sequence"/>
				<panel-related field="invoiceLineTaxList" colSpan="12" form-view="invoice-line-tax-form" grid-view="invoice-line-tax-grid"/>
			</panel>
			<panel name="accounting" title="Accounting" showTitle="false">
				<panel name="accountingDetails" title="Accounting details"  colSpan="12">
					<field name="journal" readonlyIf="statusSelect == 3" domain="self.statusSelect = 1 AND self.company = :company" form-view="journal-form" grid-view="journal-grid"/>
					<field name="partnerAccount" readonlyIf="statusSelect == 3" onSelect="action-invoice-partner-account-domain" domain="self.company = :company" form-view="account-form" grid-view="account-grid"/>
					<field name="move" readonly="true" form-view="move-form" grid-view="move-grid"/>
					<field name="move.accountingOk" readonly="true"/>
					<field name="doubtfulCustomerOk" readonly="true" showIf="doubtfulCustomerOk &amp;&amp; statusSelect == 3 &amp;&amp; (operationTypeSelect == 1 || operationTypeSelect == 3)"/>
					<field name="usherPassageOk" showIf="statusSelect == 3 &amp;&amp; (operationTypeSelect == 1 || operationTypeSelect == 3)" onChange="save,com.axelor.apps.account.web.InvoiceController:usherProcess"/>
					<field name="oldMove" readonly="true" showIf="oldMove" form-view="move-form" grid-view="move-grid"/>
				</panel>
				<panel name="refund" title="Refund" showIf="statusSelect != 1 || originalInvoice"  colSpan="12" showTitle="false">
					<button name="createRefund" title="Generate refund" colSpan="3" showIf="statusSelect != 1" onClick="save,action-invoice-method-create-refund,save" />
					<field name="originalInvoice" readonly="true" showIf="originalInvoice" form-view="invoice-form" grid-view="invoice-grid"/>
					<panel-related field="refundInvoiceList" readonly="true" showIf="refundInvoiceList != null &amp;&amp; !refundInvoiceList.isEmpty()" colSpan="12" form-view="invoice-form" grid-view="invoice-refund-grid"/>
				</panel>
				<panel colSpan="12"  name="irrecoverable" title="Irrecoverable" showIf="statusSelect == 3 &amp;&amp; (operationTypeSelect == 1 || operationTypeSelect == 3)"  showTitle="false">
					<field name="irrecoverableStatusSelect"/>
					<field name="managementObject" form-view="management-object-form" grid-view="management-object-grid"/>
					<button name="passInIrrecoverable" title="Shift to irrecoverable"   onClick="com.axelor.apps.account.web.InvoiceController:passInIrrecoverable"/>
					<button name="notPassInIrrecoverable" title="Do not shift into irrecoverable"   onClick="com.axelor.apps.account.web.InvoiceController:notPassInIrrecoverable"/>
				</panel>
			</panel>
			<panel name="blockings" title="Blockings" showIf="statusSelect == 3" showTitle="false">
				<field name="debitBlockingOk"/>
				<field name="reminderBlockingOk"/>
				<panel name="debitBlockingGroup" title="Direct debit blocking"  showIf="debitBlockingOk" colSpan="12">
					<field name="debitBlockingByUser" form-view="user-form" grid-view="user-grid"/>
					<field name="debitBlockingToDate" />
					<field name="debitBlockingReason" form-view="stop-reason-form" grid-view="stop-reason-grid" />
				</panel>
				<panel showIf="reminderBlockingOk" name="reminderBlocking" title="Reminder blocking" colSpan="12">
					<field name="reminderBlockingByUser" form-view="user-form" grid-view="user-grid"/>
					<field name="reminderBlockingToDate"/>
					<field name="reminderBlockingReason" form-view="stop-reason-form" grid-view="stop-reason-grid" />
				</panel>
			</panel>

			<panel-related title="Payments details" field="invoicePaymentList" colSpan="12"  grid-view="invoice-payment-grid" form-view="invoice-payment-form" canNew="false" canRemove="false" showIf="statusSelect == 3 || statusSelect == 4"/>

			<panel  name="directDebit" title="Direct debit" showIf="statusSelect == 3" showTitle="false">
				<panel name="paymentSchedule" title="Payment schedule" colSpan="12" >
					<field name="schedulePaymentOk" readonly="true" showIf="schedulePaymentOk"/>
					<field name="paymentSchedule" readonly="true" showIf="schedulePaymentOk" domain="self.company = :company AND self.partner = :partner" form-view="payment-schedule-form" grid-view="payment-schedule-grid"/>
				</panel>
			</panel>
			<panel title="Impression" name="impression" colSpan="12">
				<field name="invoicesCopySelect" colSpan="6" title="Invoices copy"/>
				<field name="hideDiscount" colSpan="6"/>
				<field name="note" colSpan="12"/>
			</panel>
			<panel title="Printing" name="printing" hidden="true" if-module="axelor-business-project" colSpan="12" if="__config__.app.isApp('business-project')" >
				<field name="displayTimesheetOnPrinting" />
				<field name="displayExpenseOnPrinting" />
			</panel>
		</panel-tabs>
	
		<panel-stack sidebar="true">
			<panel name="referenceDocuments" title="Reference documents" itemSpan="6">
				<field name="internalReference"/>
				<field name="externalReference"/>
			</panel>
			<panel name="dates" title="Dates" readonlyIf="statusSelect == 3">
				<field name="invoiceDate" onChange="action-invoice-record-due-date,action-invoice-record-estimated-payment-date"/>
				<field name="dueDate" onChange="action-invoice-record-estimated-payment-date"/>
				<field name="estimatedPaymentDate" readonly="true" if-module="axelor-cash-management"  if="__config__.app.isApp('cash-management')" />
			</panel>
		</panel-stack>
	 
	    <panel sidebar="true" name="actions" title="Actions" >
	        <button name="validate" title="Validate" showIf="statusSelect == 1" onClick="save,action-invoice-method-compute,action-invoice-method-validate,save"/>
	        <button name="ventilate" title="Ventilate" showIf="statusSelect == 2" onClick="save,action-invoice-method-ventilate,save" prompt="Are you sure you want to ventilate the invoice ?"/>
	        <button name="cancel" title="Cancel" onClick="save,action-invoice-method-cancel,save" prompt="Are you sure you want to cancel the invoice ?"/>
	        <button name="draft" title="Draft" showIf="statusSelect == 4" onClick="save,action-invoice-record-draft,save"/>
      	  	<button name="addPayment" title="Register payment" showIf="statusSelect == 3 &amp;&amp; companyInTaxTotalRemaining &gt; 0" colSpan="12" onClick="save,action-invoice-view-register-payment"/>
	        <field name="statusSelect"/>
	        <field name="validatedByUser" grid-view="user-grid" form-view="user-form"/>
	    </panel>
	    
		<panel sidebar="true" name="totals" title="Totals" itemSpan="6">
		    <field name="currency.symbol" hidden="true"/>
			<field name="inTaxTotal" css="order-subtotal" showTitle="false" colSpan="12">
		       <viewer><![CDATA[ 
		         <dl class="dl-horizontal">
		           <dt x-translate>Total W.T.</dt>
		           <dd>{{record.exTaxTotal}} {{record.currency.symbol}}</dd>
		           <dt x-translate>Total tax</dt>
		           <dd>{{record.taxTotal}} {{record.currency.symbol}}</dd>
		           <dt class="order-subtotal-total" x-translate>Total A.T.I.</dt>
		           <dd class="order-subtotal-total">{{record.inTaxTotal}} {{record.currency.symbol}}</dd>
		         </dl>]]>
		       </viewer>
		     </field>
		     <field name="invoicePaymentList" colSpan="12" showTitle="false" readonly="true" css="order-subtotal">
              	<viewer><![CDATA[ 
				  <span class="form-item-container">
         			<dl class="dl-horizontal">
               			<dt ng-if="record.typeSelect == 1 &amp;&amp; record.statusSelect == 1"><a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a>  <font x-translate>Paid on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
           		 		<dt ng-if="record.typeSelect == 1 &amp;&amp; record.statusSelect == 2" class="hilite-danger-text"> <a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a> <font x-translate>Paid on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
              			
              			<dt ng-if="record.typeSelect == 2 &amp;&amp; record.statusSelect == 1"><a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a> <font x-translate>Paid on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
           		 		<dt ng-if="record.typeSelect == 2 &amp;&amp; record.statusSelect == 2" class="hilite-danger-text"> <a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a> <font x-translate>Paid on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
              			
              			<dt ng-if="record.typeSelect == 3 &amp;&amp; record.statusSelect == 1"><a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a> <font x-translate>Ref. on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
           		 		<dt ng-if="record.typeSelect == 3 &amp;&amp; record.statusSelect == 2" class="hilite-danger-text"> <a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a> <font x-translate>Ref. on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
              			
              			<dt ng-if="record.typeSelect == 4 &amp;&amp; record.statusSelect == 1"><a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a> <font x-translate>Inv. on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
           		 		<dt ng-if="record.typeSelect == 4 &amp;&amp; record.statusSelect == 2" class="hilite-danger-text"> <a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a> <font x-translate>Inv. on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
              			
              			<dt ng-if="record.typeSelect == 5 &amp;&amp; record.statusSelect == 1"><a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a> <font x-translate>Other on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
           		 		<dt ng-if="record.typeSelect == 5 &amp;&amp; record.statusSelect == 2" class="hilite-danger-text"> <a href="#/ds/action-invoice-view-register-payment/edit/{{record.id}}"><i class="fa fa-link"></i></a> <font x-translate>Other on</font><font> {{record.paymentDate | date : 'dd/MM/yyyy'}}<font/></dt>
	           		 	
	           		 	<dd ng-if="record.statusSelect == 1">-{{record.amount}} {{record.currency.symbol}}</dd>
	           		 	<dd ng-if="record.statusSelect == 2" class="hilite-danger-text">(-{{record.amount}} {{record.currency.symbol}})</dd>
	           		</dl> 
           	      </span>]]>  
      			</viewer>
      			<editor layout="table" x-show-titles="false"> <label title="Paid on"/>
                     <field name="paymentDate"/>
		             <field name="amount"/>
		             <field name="currency.symbol" hidden="true"/>
   		             <field name="currency"/>
		             <field name="paymentMode"/>
		         </editor>
		     </field>
		     <field name="inTaxTotal" css="order-subtotal" showTitle="false" colSpan="12" showIf="statusSelect == 2 || statusSelect == 3">
		       <viewer><![CDATA[
		         <dl class="dl-horizontal">
		           <dt class="order-subtotal-total" x-translate>Amount due</dt>
		           <dd class="order-subtotal-total">{{record.amountRemaining}} {{record.currency.symbol}}</dd>
		         </dl>]]>
		       </viewer>
		     </field>
		</panel>
		<panel name="totalsCompanyCurrency" title="Totals company currency" itemSpan="6" sidebar="true" >
		    <field name="company.currency.symbol" hidden="true"/>
		    <field name="companyInTaxTotal" showTitle="false" colSpan="12" css="order-subtotal" >
		      <viewer><![CDATA[ 
		         <dl class="dl-horizontal">
		           <dt x-translate>Total W.T.</dt>
		           <dd>{{record.companyExTaxTotal}} {{record.company.currency.symbol}}</dd>
		           <dt x-translate>Total tax</dt>
		           <dd>{{record.companyTaxTotal}} {{record.company.currency.symbol}}</dd>
		           <dt class="order-subtotal-total" x-translate>Total A.T.I.</dt>
		           <dd class="order-subtotal-total">{{record.companyInTaxTotal}} {{record.company.currency.symbol}}</dd>
					<dt x-translate>Total Amount Remaining</dt>
		           <dd class="order-subtotal-total">{{record.companyInTaxTotalRemaining}} {{record.company.currency.symbol}}</dd>
		         </dl>
		       ]]></viewer>
		    </field>
		  </panel>
		
		<panel-mail>
		  <mail-messages limit="4" />
		  <mail-followers />
	  	</panel-mail>
	</form>
    
   
    
  
    
 
	
</object-views>
